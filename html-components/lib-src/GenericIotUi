<script>
	var uigen = angular.module("uiGen");
	if(uigen == null){
// REVIEW: atentie la formatare; am vazut in mai multe locuri. Trebuie folosita ac. conventie ca si la java. E.g. aici lipsesc 2 spatii
		uigen = angular.module("uiGen", ['ui.bootstrap']);
// REVIEW: ce face acest cod/if? de ce avem nevoie de el
	}
	uigen.controller("GenericComponentCtrl", ['$scope', '$http', '$interval', '$location', function($scope, $http, $interval, $location) {
		$scope.freeMem = 0;
		var boardUrl = ($location.search().boardUrl != undefined ? $location.search().boardUrl : "");
		var statusUrl, descriptorsUrl;
		if(boardUrl != ""){
			statusUrl = 'http://' + boardUrl + '/getState';
			descriptorsUrl = "getDescriptors2";
// REVIEW: exista o problema majora. Trebuie delimitat clar ce sta in template-ul root, si ce sta in template-ul acestui component. 
// codul asta, logica de status precum si eticheta freemem nu ar trebui sa stea aici, ci in template-ul root. De asemenea, ce e cu acest
// "getDescriptors2"
		}else{
			statusUrl = "getStatus";
			descriptorsUrl = "getDescriptors"
		}
		
		var getDescriptorsValues = function(elements){
				$scope.freeMem = elements.FREE_MEM;
				for (var i = 0; i < $scope.descriptors.elems.length; i++) {
					$scope.descriptors.elems[i].value = eval("elements." + $scope.descriptors.elems[i].name);
// REVIEW: functia asta nu este necesara. Imi amintesc ca am vb deja acest lucru. getStatus (care sta in tpl root dupa cum am zis mai sus)
// primeste un json. Ea ea acest json si il pune in $scope.status. Toate elementele grafice fac bind pe $scope.status.???; e.g. $scope.status.freeMem, 
// $scope.status.light1, etc.
				}
		}
		var checkStatus = function() {
			$http.get(statusUrl).success(function(response) {
				getDescriptorsValues(response);
			})
		};
		$interval(checkStatus, 1000);
		$http.get(descriptorsUrl).success(function(response) {
			$scope.descriptors = response;
		})
	}]);
</script>
<div class="container-fluid" ng-controller="GenericComponentCtrl">
	<div class="row">
		<div class="col-md-4 col-md-offset-4">
			<div class="panel panel-primary text-center">
				<div class="panel-heading">Status</div>
				<div class="panel-body">
					<div ng-repeat="elem in descriptors.elems">
						<span> Value of {{elem.label}} is {{elem.value}}</span>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="row">
		<div class="col-md-4 col-md-offset-4">
			<div class="panel panel-primary text-center">
				<div class="panel-heading">Commands</div>
				<div class="panel-body">
					<button ng-repeat="button in descriptors.commands" class="btn btn-block btn-lg" type="button" ng-click="invoke(button.onclick)">
				{{button.text}}
		   </button>
				</div>
			</div>
		</div>
	</div>
	<div class="row">
		<div class=" col-md-8 col-md-offset-4"><span class="label label-default"><span class="glyphicon glyphicon-dashboard"></span> Free memory (SRAM): {{freeMem}} bytes</span>
		</div>
	</div>
</div>